<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Go最新的dep详解 - 虞双齐的博客</title><link rel="alternate" hreflang="zh" href="https://yushuangqi.com"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="applicable-device" content="pc,mobile"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#f8f5ec"><meta name="msapplication-navbutton-color" content="#f8f5ec"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec"><meta name="mobile-web-app-capable" content="yes"><meta name="author" content="虞双齐"><meta name="description" content="该文翻译自https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngs"><meta name="keywords" content="智能合约开发, Go语言, 区块链技术"><meta name="generator" content="Hugo 0.37.1"><link rel="canonical" href="https://yushuangqi.com/blog/2017/gozui-xin-de-depxiang-jie.html"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous"><meta property="og:title" content="Go最新的dep详解"><meta property="og:description" content="该文翻译自https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngs"><meta property="og:type" content="article"><meta property="og:url" content="https://yushuangqi.com/blog/2017/gozui-xin-de-depxiang-jie.html"><meta property="article:published_time" content="2017-02-18T11:13:41&#43;08:00"><meta property="article:modified_time" content="2017-02-18T11:13:41&#43;08:00"><meta itemprop="name" content="Go最新的dep详解"><meta itemprop="description" content="该文翻译自https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngs"><meta itemprop="datePublished" content="2017-02-18T11:13:41&#43;08:00"><meta itemprop="dateModified" content="2017-02-18T11:13:41&#43;08:00"><meta itemprop="wordCount" content="2683"><meta itemprop="keywords" content="golang,"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Go最新的dep详解"><meta name="twitter:description" content="该文翻译自https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngs"><!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]--><!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"><a href="/" class="logo">虞双齐的博客</a></div><div class="mobile-navbar-icon"><span></span> <span></span> <span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/"><li class="mobile-menu-item">首页</li></a><a href="/series.html"><li class="mobile-menu-item">专题</li></a><a href="/categories.html"><li class="mobile-menu-item">分类</li></a><a href="/tags.html"><li class="mobile-menu-item">标签</li></a><a href="/post.html"><li class="mobile-menu-item">归档</li></a><a href="/about.html"><li class="mobile-menu-item">关于</li></a></ul></nav><header id="header" class="header container"><div class="logo-wrapper"><a href="/" class="logo">虞双齐的博客</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"><a class="menu-item-link" href="/">首页</a></li><li class="menu-item"><a class="menu-item-link" href="/series.html">专题</a></li><li class="menu-item"><a class="menu-item-link" href="/categories.html">分类</a></li><li class="menu-item"><a class="menu-item-link" href="/tags.html">标签</a></li><li class="menu-item"><a class="menu-item-link" href="/post.html">归档</a></li><li class="menu-item"><a class="menu-item-link" href="/about.html">关于</a></li></ul></nav></header><div id="mobile-panel"><main id="main" class="main bg-llight"><div class="content-wrapper"><div id="content" class="content container"><article class="post bg-white"><header class="post-header"><h1 class="post-title">Go最新的dep详解</h1><div class="post-meta"><span class="post-time">2017-02-18</span><div class="post-category"><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%BC%80%E5%8F%91.html">编程语言与开发</a></div><span class="more-meta">约 2683 字 </span><span class="more-meta">预计阅读 6 分钟</span></div></header><div class="post-toc" id="post-toc"><h2 class="post-toc-title">文章目录</h2><div class="post-toc-content always-active"><nav id="TableOfContents"><ul><li><ul><li><a href="#起初">起初</a></li><li><a href="#确保项目可以编译">确保项目可以编译</a></li><li><a href="#添加依赖">添加依赖</a></li><li><a href="#如果最新版本不合适呢">如果最新版本不合适呢？</a></li><li><a href="#保持更新">保持更新</a></li><li><a href="#status">Status</a></li><li><a href="#移除依赖">移除依赖</a></li><li><a href="#未来">未来</a></li></ul></li></ul></nav></div></div><div class="post-content"><p>该文翻译自<a href="https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngswi0e">https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngswi0e</a></p><p>我很高兴在过去几个月和几个其他gopher开发的一个原型依赖管理工具，名为dep。</p><p>dep是去年开始由Peter Bourgon组织的项目的一部分。由于我参与开发了一个“godep”，Go的OG依赖管理工具（继承自Keith Rarick），因此加入了dep项目的团队。</p><p>除了我自己和Peter，团队的其他成员是Jessie Frazelle，Andrew Gerrand和Sam Boyer。 Andrew是Google Go team的一员。 Jessie在Google工作，并参与过大型Go项目，如Docker和Kubernetes。 Sam维护gps。</p><p>该团队发布了一系列我们工作过程中的进展信息。到目前为止，各种其他工具作者和相关方也以不同的方式参与这一项目。</p><h2 id="起初">起初</h2><p>假设我们正在使用github.com/gorilla/mux编写一个Web应用程序。 这里是一些代码，让我们开始：</p><pre><code>package main

import (
    &quot;net/http&quot;
    &quot;os&quot;

    &quot;github.com/gorilla/mux&quot;
)

func main() {
    r := mux.NewRouter()
    r.Handle(&quot;/&quot;, http.FileServer(http.Dir(&quot;.&quot;)))
    http.ListenAndServe(&quot;:&quot;+os.Getenv(&quot;PORT&quot;), r)
}
</code></pre><p>在现有项目上第一次使用dep时，需要运行dep init。</p><p>dep init将在GOPATH中已经包含github.com/gorilla/mux，manifest.json文件将包括它。我先运行如下命令：</p><pre><code>go get -u github.com/gorilla/mux
</code></pre><p>所以在我的\$GOPATH中github.com/gorilla/mux的分支是master。如果我的\$GOPATH中的版本匹配Semver tag（例如：v1.2.3），那么将使用该tag的名称。</p><p>dep可以跨越架构和go版本。我们可以将github.com/gorilla/mux与旧版本的Go（&lt;1.7.0）的github.com/gorilla/context包结合使用。当我最后运行</p><pre><code>go get -u github.com/gorilla/mux
</code></pre><p>的时候，我运行的是Go 1.7.5，所以github.com/gorilla/context包不在我的\$GOPATH。因为可能是编译项目所需的依赖，它会包含在lock.json文件中。在这种场景下，如果从属项目有一个semver兼容的release tag，dep会选择最新的版本。在这种情况下是github.com/gorilla/context的v1.1。</p><p>因为github.com/gorilla/mux不包含manifest.json文件，dep不知道github.com/gorilla/mux目前是否能与github.com/gorilla/context@v1.1配合使用。dep一般使用在依赖的manifest.json文件中找到的约束。</p><p>dep init包括所有依赖关系（包括递归依赖）以及在lock.json文件中使用的确切版本。</p><p>对于示例应用程序，这将创建以下两个文件：<br>lock.json</p><pre><code>{
    &quot;memo&quot;: &quot;d741a3bed21fe6cae9d67c523b0a343859882b2f246f2a293e2676cfacd5a2ce&quot;,
    &quot;projects&quot;: [
        {
            &quot;name&quot;: &quot;github.com/gorilla/context&quot;,
            &quot;version&quot;: &quot;v1.1&quot;,
            &quot;revision&quot;: &quot;a85d2e53ba63bdea074dbbbb5983f0516974e87b&quot;,
            &quot;packages&quot;: [
                &quot;.&quot;
            ]
        },
        {
            &quot;name&quot;: &quot;github.com/gorilla/mux&quot;,
            &quot;branch&quot;: &quot;master&quot;,
            &quot;revision&quot;: &quot;392c28fe23e1c45ddba891b0320b3b5df220beea&quot;,
            &quot;packages&quot;: [
                &quot;.&quot;
            ]
        }
    ]
}
</code></pre><p>manifest.json</p><pre><code>{
    &quot;dependencies&quot;: {
        &quot;github.com/gorilla/mux&quot;: {
            &quot;branch&quot;: &quot;master&quot;
        }
    }
}
</code></pre><h2 id="确保项目可以编译">确保项目可以编译</h2><p>在运行dep init之后，应该运行dep ensure以便将构建项目所需的软件包副本填充在vendor/目录。 这确保任何项目的依赖项都包括在lock文件和vendor目录中。 如果你想确保记录所有的依赖，运行dep ensure。</p><h2 id="添加依赖">添加依赖</h2><p>添加另一个依赖项，只需在代码中使用它。 当需要检查你的工作时，你需要运行dep ensure更新lock.json文件和vendor/。 这将锁定项目到每个依赖项的最新发布版本。</p><h2 id="如果最新版本不合适呢">如果最新版本不合适呢？</h2><p>如果需要指定版本，可以使用ensure命令的备用形式，如：dep ensure github.com/gorilla/mux@\\^1.3.0。该命令修改manifest.json文件，约束dep使用github.com/gorilla/mux的\\^v1.3.0版本，解析依赖关系树并更新vendor/中的依赖关系。在示例应用程序上，因为dep已经选择了最新的可用版本1.3.0。但是，以后的更新（dep ensure -update）将不再跟踪主分支，而是使用semver标记的版本≥1.3.0和&lt;2.0.0。</p><p>dep主要使用Rust cargo类似的操作符来选择依赖的版本。这些包括\\^，～和=。还有一个更严格的，向前兼容的匹配比\\^使用～。例如，dep确保github.com/com/gorilla/mux@~1.2.0将匹配大于等于1.2.0和小于1.3.0任何版本。要锁定到特定版本，请使用=（e.x. dep ensure github.com/com/gorilla/mux@=1.2.0）。在未来，dep计划将\\^作为默认前缀。</p><h2 id="保持更新">保持更新</h2><p>要保持项目的依赖关系最新使用dep ensure -update，它将所有依赖关系更新为由manifest.json中的约束所允许的最新版本，并忽略lock.json的内容。 将新版本写入vendor/，并在lock.json中更新相应的元数据。<br>在将来，可以用dep ensure -update 更新单个依赖关系。</p><h2 id="status">Status</h2><p>当缺少依赖项时，dep status会告诉您哪些软件包缺失。 例如，这里是dep status的输出：</p><pre><code>$ dep status
PROJECT                 MISSING PACKAGES
github.com/boltdb/bolt  [github.com/boltdb/bolt]
</code></pre><p>如果项目的lock.json是最新的，dep status命令显示所有依赖项的列表，作为项目，并为每个：</p><ul><li><p>应用约束</p></li><li><p>选版本</p></li><li><p>所选修订版本</p></li><li><p>最新版本或修订版本</p></li><li><p>使用的软件包数量。<br>将bolt添加到示例项目并运行dep后，确保更新lock.json和vendor/，dep status如下所示：</p></li></ul><pre><code>$ dep status
PROJECT                     CONSTRAINT  VERSION        REVISION  LATEST   PKGS USED
github.com/boltdb/bolt      *           v1.3.0         583e893   v1.3.0   1
github.com/gorilla/context  *           v1.1           a85d2e5   v1.1     1
github.com/gorilla/mux      ^1.3.0      v1.3.0         392c28f   v1.3.0   1
golang.org/x/sys            *           branch master  7a6e564   7a6e564  1
</code></pre><p>这两种模式可以在将来合并。</p><h2 id="移除依赖">移除依赖</h2><p>dep remove删除manifest.json，lock.json和vendor/中的依赖关系。 使用示例应用程序，此提交从应用程序中删除github.com/gorilla/mux的使用，下一个提交是dep remove github.com/gorilla/mux的结果。 因为github.com/gorilla/mux被删除，github.com/gorilla/context不再需要，也会被删除。 如果在运行dep remove时仍然使用依赖关系，则命令将失败。 可以使用-force强制从manifest.json中删除约束。 但是，由于依赖项仍在使用中，它仍然在lock.json中并复制到vendor/。</p><h2 id="未来">未来</h2><p>dep仍然处于实验阶段，有许多问题需要解决和很多工作要做。 我希望这篇文章清楚地显示了一些如何使用工具的例子。 使用方式可能会随着时间的推移通过社区反馈和请求而改变。 如果你有一些空闲时间，并有兴趣参与一些Go工具开发，请现在开始。<br>谢谢阅读！</p></div><div style="height:130px"><div class="post-copyright" style="float:left"><p class="copyright-item"><span class="item-title">文章作者</span> <span class="item-content">虞双齐</span></p><p class="copyright-item"><span class="item-title">上次更新</span> <span class="item-content">2017-02-18</span></p><p class="copyright-item"><span class="item-title">许可协议</span> <span class="item-content"><a target="_blank" rel="license noopener external nofollow" href="https://creativecommons.org/licenses/by/4.0/deed.zh">署名 4.0 国际</a></span></p></div><div class="post-copyright" style="float:right"><a href="https://info.flagcounter.com/8B1z" target="_blank" rel="noopener external nofollow"><img src="https://s05.flagcounter.com/countxl/8B1z/bg_FFFFFF/txt_000000/border_CCCCCC/columns_4/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a></div></div><div class="post-reward"><input type="checkbox" name="reward" id="reward" hidden> <label class="reward-button" for="reward">赞赏支持</label><div class="qr-code"><label class="qr-code-image" for="reward"><img class="image" src="/img/donateMe_wechat.png"> <span>微信打赏</span></label></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/golang.html">golang</a></div><nav class="post-nav"><a class="prev" href="/blog/2017/shu-ju-ku-bu-kuo-ge-dockerji-rong-qi-hua-de-7da-yuan-yin.html"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">数据库不适合Docker及容器化的7大原因</span> <span class="prev-text nav-mobile">上一篇</span> </a><a class="next" href="/blog/2017/you-xiu-de-go-cun-chu-kai-yuan-xiang-mu-he-ku.html"><span class="next-text nav-default">优秀的 Go存储开源项目和库</span> <span class="prev-text nav-mobile">下一篇</span> <i class="iconfont icon-right"></i></a></nav></footer><div class="disqus-button" id="load_disqus" onclick="load_disqus()">显示 Disqus 评论</div><div id="disqus_thread"></div><script type="text/javascript">function load_disqus() {
        
        
        if (window.location.hostname === 'localhost') return;

        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'yushuangqi';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

        $('#load_disqus').remove();
    };</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></article></div></div></main><footer id="footer" class="footer"><div class="social-links"><a href="mailto:ysqi@yushuangqi.com" rel="me" class="iconfont icon-email" title="email"></a> <a href="http://github.com/ysqi" rel="me" class="iconfont icon-github" title="github"></a> <a href="https://weibo.com/234665601" rel="me" class="iconfont icon-weibo" title="weibo"></a> <a href="https://www.zhihu.com/people/_ysqi/" rel="me" class="iconfont icon-zhihu" title="zhihu"></a> <a href="https://yushuangqi.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a></div><div class="copyright"><span class="power-by">Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a> </span><span class="division">|</span> <span class="theme-info">Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a> </span><span class="copyright-year">&copy; 2014 - 2021 <span class="heart"><i class="iconfont icon-heart"></i> </span><span class="author">虞双齐 | <a href="https://beian.miit.gov.cn/">粤ICP备14032560号</a></span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });</script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script><script id="baidu_analytics">var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?a16b3275b071ec0efc507a05422a7156";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();</script></body></html>