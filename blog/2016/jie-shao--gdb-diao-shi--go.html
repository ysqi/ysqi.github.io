<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>介绍GDB调试Go - 虞双齐的博客</title><link rel="alternate" hreflang="zh" href="https://yushuangqi.com"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="applicable-device" content="pc,mobile"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#f8f5ec"><meta name="msapplication-navbutton-color" content="#f8f5ec"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec"><meta name="mobile-web-app-capable" content="yes"><meta name="author" content="虞双齐"><meta name="description" content="注：本文作者是 YANN，原文是 Introduction to Go Debugging with GDB 在过去的 4 年中，我花了我绝大部分的时间用来写，读以及调试 Python 或 JavaScript 代码。在学习 Go 的过程中，像穿着一双有"><meta name="keywords" content="智能合约开发, Go语言, 区块链技术"><meta name="generator" content="Hugo 0.37.1"><link rel="canonical" href="https://yushuangqi.com/blog/2016/jie-shao--gdb-diao-shi--go.html"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous"><meta property="og:title" content="介绍GDB调试Go"><meta property="og:description" content="注：本文作者是 YANN，原文是 Introduction to Go Debugging with GDB 在过去的 4 年中，我花了我绝大部分的时间用来写，读以及调试 Python 或 JavaScript 代码。在学习 Go 的过程中，像穿着一双有"><meta property="og:type" content="article"><meta property="og:url" content="https://yushuangqi.com/blog/2016/jie-shao--gdb-diao-shi--go.html"><meta property="article:published_time" content="2016-12-31T11:34:43&#43;08:00"><meta property="article:modified_time" content="2016-12-31T11:34:43&#43;08:00"><meta itemprop="name" content="介绍GDB调试Go"><meta itemprop="description" content="注：本文作者是 YANN，原文是 Introduction to Go Debugging with GDB 在过去的 4 年中，我花了我绝大部分的时间用来写，读以及调试 Python 或 JavaScript 代码。在学习 Go 的过程中，像穿着一双有"><meta itemprop="datePublished" content="2016-12-31T11:34:43&#43;08:00"><meta itemprop="dateModified" content="2016-12-31T11:34:43&#43;08:00"><meta itemprop="wordCount" content="891"><meta itemprop="keywords" content="gdb,debug,golang,"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="介绍GDB调试Go"><meta name="twitter:description" content="注：本文作者是 YANN，原文是 Introduction to Go Debugging with GDB 在过去的 4 年中，我花了我绝大部分的时间用来写，读以及调试 Python 或 JavaScript 代码。在学习 Go 的过程中，像穿着一双有"><!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]--><!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"><a href="/" class="logo">虞双齐的博客</a></div><div class="mobile-navbar-icon"><span></span> <span></span> <span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/"><li class="mobile-menu-item">首页</li></a><a href="/series.html"><li class="mobile-menu-item">专题</li></a><a href="/categories.html"><li class="mobile-menu-item">分类</li></a><a href="/tags.html"><li class="mobile-menu-item">标签</li></a><a href="/post.html"><li class="mobile-menu-item">归档</li></a><a href="/about.html"><li class="mobile-menu-item">关于</li></a></ul></nav><header id="header" class="header container"><div class="logo-wrapper"><a href="/" class="logo">虞双齐的博客</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"><a class="menu-item-link" href="/">首页</a></li><li class="menu-item"><a class="menu-item-link" href="/series.html">专题</a></li><li class="menu-item"><a class="menu-item-link" href="/categories.html">分类</a></li><li class="menu-item"><a class="menu-item-link" href="/tags.html">标签</a></li><li class="menu-item"><a class="menu-item-link" href="/post.html">归档</a></li><li class="menu-item"><a class="menu-item-link" href="/about.html">关于</a></li></ul></nav></header><div id="mobile-panel"><main id="main" class="main bg-llight"><div class="content-wrapper"><div id="content" class="content container"><article class="post bg-white"><header class="post-header"><h1 class="post-title">介绍GDB调试Go</h1><div class="post-meta"><span class="post-time">2016-12-31</span><div class="post-category"><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%BC%80%E5%8F%91.html">编程语言与开发</a></div><span class="more-meta">约 891 字 </span><span class="more-meta">预计阅读 2 分钟</span></div></header><div class="post-toc" id="post-toc"><h2 class="post-toc-title">文章目录</h2><div class="post-toc-content always-active"></div></div><div class="post-content"><blockquote><p>注：本文作者是 <a href="http://lincolnloop.com/blog/by-author/yml/">YANN</a>，原文是 <a href="http://lincolnloop.com/blog/introduction-go-debugging-gdb/">Introduction to Go Debugging with GDB</a></p></blockquote><p>在过去的 4 年中，我花了我绝大部分的时间用来写，读以及调试 Python 或 JavaScript 代码。在学习 Go 的过程中，像穿着一双有小石子的鞋子在美丽的山中远行。很多事情给我留下了深刻的印象，但是使用 <code>println</code> 调试我的代码在过去走的太远了。在 Python 中，当代码在运行的时候，我们使用 <code>pdb/ipdb</code> 调试它，JavaScript 提供了类似的工具。在这些年中，这个模式已经变成了我工作流中非常重要的一部分了。</p><p>今天，我认识到 Go 已经内建支持 <a href="http://sourceware.org/gdb/current/onlinedocs/gdb/">Gnu debugger (aka GDB)</a>。</p><p>为了这篇文章，我们使用以下这个简单的程序：</p><pre><code class="language-Go">    package main

    import (
        &quot;fmt&quot;
        &quot;time&quot;
    )

    func counting(c chan&lt;- int) {
        for i := 0; i &lt; 10; i++ {
            time.Sleep(2 * time.Second)
            c &lt;- i
        }
        close(c)
    }

    func main() {
        msg := &quot;Starting main&quot;
        fmt.Println(msg)
        bus := make(chan int)
        msg = &quot;starting a gofunc&quot;
        go counting(bus)
        for count := range bus {
            fmt.Println(&quot;count:&quot;, count)
        }
    }
</code></pre><p>为了使用 GDB，你需要使用 <code>-gcflags ”-N -l”</code> 选项编译你的程序，这些选项阻止编译器使用内联函数和变量。</p><pre><code class="language-Go">    go build -gcflags &quot;-N -l&quot; gdbsandbox.go
</code></pre><p>这是一个交互式的调试 GDB 的会话示例：</p><pre><code>yml@simba$  gdb gdbsandbox 
GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2) 7.4-2012.04
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
</code></pre><p>首先，我们运行我们的程序：</p><pre><code>(gdb) run
Starting program: /home/yml/Developments/go/src/gdbsandbox/gdbsandbox 
Starting main
count: 0
count: 1
count: 2
[...]
count: 9
[Inferior 1 (process 13507) exited normally]
</code></pre><p>现在我们知道怎样运行我们的程序，我们可能想设置一个断点。</p><pre><code>(gdb) help break 
Set breakpoint at specified line or function.
break [LOCATION] [thread THREADNUM] [if CONDITION]
LOCATION may be a line number, function name, or &quot;*&quot; and an address.
[...]
(gdb) break 22
Breakpoint 1 at 0x400d7a: file /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go, line 22.
(gdb) run
Starting program: /home/yml/Developments/go/src/gdbsandbox/gdbsandbox 
Starting main
[New LWP 13672]
[Switching to LWP 13672]
Breakpoint 1, main.main () at /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go:22
22              for count := range bus {
(gdb) 
</code></pre><p>一旦 GDB 在你的断点处停止，你将看到上下文：</p><pre><code>(gdb) help list
List specified function or line.
With no argument, lists ten more lines after or around previous listing.
&quot;list -&quot; lists the ten lines before a previous ten-line listing.
[...]
(gdb) list
17              msg := &quot;Starting main&quot;
18              fmt.Println(msg)
19              bus := make(chan int)
20              msg = &quot;starting a gofunc&quot;
21              go counting(bus)
22              for count := range bus {
23                      fmt.Println(&quot;count:&quot;, count)
24              }
25      }
</code></pre><p>你也可以检查变量：</p><pre><code>(gdb) help print
Print value of expression EXP.
Variables accessible are those of the lexical environment of the selected
stack frame, plus all those whose scope is global or an entire file.
[...]
(gdb) print msg
$1 = &quot;starting a gofunc&quot;
</code></pre><p>在代码的早期，我们启动了一个 <code>goroutine</code>，当我执行到第 10 行的时候，我想查看我程序中的这部分。</p><pre><code>(gdb) break 10
Breakpoint 3 at 0x400c28: file /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go, line 10.
(gdb) help continue
Continue program being debugged, after signal or breakpoint.
If proceeding from breakpoint, a number N may be used as an argument,
which means to set the ignore count of that breakpoint to N - 1 (so that
the breakpoint won't break until the Nth time it is reached).
[...]
(gdb) continue
Continuing.
</code></pre><p>在今天我们要做的最后一件事情就是在运行期改变一个变量的值：</p><pre><code>Breakpoint 3, main.counting (c=0xf840001a50) at /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go:10
10                      time.Sleep(2 * time.Second)
(gdb) help whatis
Print data type of expression EXP.
Only one level of typedefs is unrolled.  See also &quot;ptype&quot;.
(gdb) whatis count
type = int
(gdb) print count
$3 = 1
(gdb) set variable count=3
(gdb) print count
$4 = 3
(gdb) c
Continuing.
count: 3
</code></pre><p>我们仅仅覆盖了以下命令：</p><ul><li>list</li><li>next</li><li>print</li><li>continue</li><li>break</li><li>whatis</li><li>set variable =</li></ul><p>这几乎只是涉及到了使用 GDB 的表面知识，如果你想学习关于 GDB 更多的知识，这里有更多的链接：</p><ul><li><a href="http://sourceware.org/gdb/current/onlinedocs/gdb/">http://sourceware.org/gdb/current/onlinedocs/gdb/</a></li><li><a href="http://golang.org/doc/gdb">http://golang.org/doc/gdb</a></li></ul></div><div style="height:130px"><div class="post-copyright" style="float:left"><p class="copyright-item"><span class="item-title">文章作者</span> <span class="item-content">虞双齐</span></p><p class="copyright-item"><span class="item-title">上次更新</span> <span class="item-content">2016-12-31</span></p><p class="copyright-item"><span class="item-title">许可协议</span> <span class="item-content"><a target="_blank" rel="license noopener external nofollow" href="https://creativecommons.org/licenses/by/4.0/deed.zh">署名 4.0 国际</a></span></p></div><div class="post-copyright" style="float:right"><a href="https://info.flagcounter.com/8B1z" target="_blank" rel="noopener external nofollow"><img src="https://s05.flagcounter.com/countxl/8B1z/bg_FFFFFF/txt_000000/border_CCCCCC/columns_4/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a></div></div><div class="post-reward"><input type="checkbox" name="reward" id="reward" hidden> <label class="reward-button" for="reward">赞赏支持</label><div class="qr-code"><label class="qr-code-image" for="reward"><img class="image" src="/img/donateMe_wechat.png"> <span>微信打赏</span></label></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/gdb.html">gdb</a> <a href="/tags/debug.html">debug</a> <a href="/tags/golang.html">golang</a></div><nav class="post-nav"><a class="prev" href="/blog/2016/golangshi-xian-kuai-su-pai-xu.html"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">golang实现快速排序</span> <span class="prev-text nav-mobile">上一篇</span> </a><a class="next" href="/blog/2016/golang-read-file-line-by-line.html"><span class="next-text nav-default">GolangReadFilelinebyline</span> <span class="prev-text nav-mobile">下一篇</span> <i class="iconfont icon-right"></i></a></nav></footer><div class="disqus-button" id="load_disqus" onclick="load_disqus()">显示 Disqus 评论</div><div id="disqus_thread"></div><script type="text/javascript">function load_disqus() {
        
        
        if (window.location.hostname === 'localhost') return;

        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'yushuangqi';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

        $('#load_disqus').remove();
    };</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></article></div></div></main><footer id="footer" class="footer"><div class="social-links"><a href="mailto:ysqi@yushuangqi.com" rel="me" class="iconfont icon-email" title="email"></a> <a href="http://github.com/ysqi" rel="me" class="iconfont icon-github" title="github"></a> <a href="https://weibo.com/234665601" rel="me" class="iconfont icon-weibo" title="weibo"></a> <a href="https://www.zhihu.com/people/_ysqi/" rel="me" class="iconfont icon-zhihu" title="zhihu"></a> <a href="https://yushuangqi.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a></div><div class="copyright"><span class="power-by">Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a> </span><span class="division">|</span> <span class="theme-info">Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a> </span><span class="copyright-year">&copy; 2014 - 2021 <span class="heart"><i class="iconfont icon-heart"></i> </span><span class="author">虞双齐 | <a href="https://beian.miit.gov.cn/">粤ICP备14032560号</a></span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script><script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });</script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script><script id="baidu_analytics">var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?a16b3275b071ec0efc507a05422a7156";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();</script></body></html>